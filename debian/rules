#!/usr/bin/make -f
# -*- makefile -*-

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

%:
	dh $@

override_dh_install:
	cp -r "$(CURDIR)/db/"  "$(CURDIR)/dns/"  "$(CURDIR)/http/" "$(CURDIR)/aegir.make" "$(CURDIR)/platform/" "$(CURDIR)"/*.inc "$(CURDIR)"/*.php "$(CURDIR)"/*.info "$(CURDIR)/debian/aegir-provision/usr/share/drush/commands/provision/"
	cp "$(CURDIR)/debian/aegir-provision.lintian" "$(CURDIR)/debian/aegir-provision/usr/share/lintian/overrides/aegir-provision"

# this builds a debian package based on what the current branches are
# this usually tests the latest release
jenkins-build-official:
	git-buildpackage -b --git-upstream-branch=origin/upstream --git-debian-branch=origin/debian --git-ignore-branch -kjenkins@ci.aegirproject.org

version=$(shell git describe --match 'debian/*' --tags | sed 's/debian\///;s/-\([0-9]*\)-\([0-9]*\)-/-\1+\2/' )

# this builds a debian package but first updates the branches to follow the latest 1.x branch
jenkins-build-auto:
	-git branch -D tmpdebian
	git checkout -b tmpdebian origin/debian
	git merge origin/6.x-1.x
	dch -v ${version} "automatic jenkins build"
	git commit -m"dummy commit for $version autobuild" debian/changelog
	git-buildpackage -b --git-upstream-branch=origin/6.x-1.x --git-debian-branch=tmpdebian -kjenkins@ci.aegirproject.org
	git checkout ${GIT_COMMIT}
